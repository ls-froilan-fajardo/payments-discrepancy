<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Payments Reconciliation Tool</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>

<div class="header-row">
    <div class="main-title-group" style="display: flex; align-items: center;">
        <h1>Payments Dashboard</h1>
        <button id="helpBtn" class="help-btn" title="How to use">?</button>
    </div>
    
    <div class="global-controls-container">
        <button id="themeToggleBtn" class="primary-btn" style="background-color: var(--undo);">ðŸŒ™ Dark</button>
        
        <div class="separator" style="width:1px; height:20px; background:var(--border); margin:0 5px;"></div>

        <label style="font-size:11px; font-weight:600; color:var(--text-muted);">Filter:</label>
        <select id="globalDateFilter" class="date-select">
            <option value="">All Dates</option>
        </select>
        
        <button id="matchAllBtn" class="primary-btn">Match IDs</button>
        <button id="sortAmountBtn" class="primary-btn filter-btn">Sort Amount</button>
        <button id="showRedOnlyBtn" class="primary-btn filter-btn">Red Only</button>
        <button id="resetViewBtn" class="primary-btn reset-btn">Reset</button>
    </div>
</div>

<div class="controls-section">
    <div class="control-panel left-control-panel">
        <div class="panel-header">
            <h3>Back Office</h3>
            <input type="file" id="csvFileLeft" accept=".csv" />
        </div>
        
        <div style="margin-bottom: 5px; display: flex; align-items: center;">
            <label for="leftDateFormat" style="font-size:11px; font-weight:700; color:var(--text-muted); margin-right: 6px; white-space: nowrap;">CSV File Date Format:</label>
            <select id="leftDateFormat" class="date-select" style="flex: 1; margin:0;">
                <option value="DD/MM/YYYY">DD/MM/YYYY</option>
                <option value="DD/MM/YY">DD/MM/YY</option>
                <option value="MM/DD/YYYY">MM/DD/YYYY</option>
                <option value="MM/DD/YY">MM/DD/YY</option>
                <option value="YYYY-MM-DD">YYYY-MM-DD</option>
                <option value="DD.MM.YYYY">DD.MM.YYYY</option>
                <option value="MM.DD.YYYY">MM.DD.YYYY</option>
            </select>
        </div>

        <div class="checkbox-area">
            <strong>Method:</strong>
            <div class="checkboxes" id="methodCheckboxesLeft"></div>
        </div>
    </div>

    <div class="control-panel right-control-panel">
        <div class="panel-header">
            <h3>Financial Services</h3>
            <input type="file" id="csvFileRight" accept=".csv" />
        </div>
        <div style="margin-bottom: 5px; height: 26px;"></div> 
        <div class="checkbox-area">
            <strong>Channel:</strong>
            <div class="checkboxes" id="channelCheckboxesRight"></div>
        </div>
    </div>
</div>

<div class="table-action-toolbar">
    <span class="label-text">Selected Actions (Space/Del/Ctrl+Z):</span>
    <button id="btnShift" class="btn-shift">Shift Down</button>
    <button id="btnRemove" class="btn-remove">Remove Row</button>
    <div style="flex-grow:1"></div> 
    <button id="btnUndo" class="btn-undo">Undo</button>
    <button id="btnUndoAll" class="btn-undo-all" style="margin-left: 6px;">Undo All</button>
</div>

<div class="unified-scroll-view">
    <div class="split-table-container">
        <div id="outputLeft" class="table-side left-side"></div>
        <div id="outputRight" class="table-side right-side"></div>
    </div>
</div>

<div id="floatingWidget" class="floating-widget">
    <div id="floatingHeader" class="widget-header">
        <span>Selection Total</span>
        <span style="font-size: 10px; opacity: 0.7;">::</span>
    </div>
    <div class="widget-content">
        <div class="stat-row">
            <span class="stat-label">Sum:</span>
            <span id="floatSum" class="stat-value">0.00</span>
        </div>
        <div class="stat-row">
            <span class="stat-label">Count:</span>
            <span id="floatCount" class="stat-value">0</span>
        </div>
    </div>
</div>

<div id="helpModal" class="modal-overlay hidden">
    <div class="modal-content">
        <div class="modal-header">
            <h2>User Guide</h2>
            <button id="closeHelpBtn" class="close-modal">&times;</button>
        </div>
        <div class="modal-body" style="line-height: 1.6;">
            
            <h3 style="margin-top:0; color:var(--primary);">1. Getting Started</h3>
            <ul style="padding-left: 20px; margin-bottom: 10px;">
                <li><strong>Upload Files:</strong> Click "Choose File" in the Left (Back Office Payments Report) and Right (Financial Services Payments Report) panels to load your CSVs.</li>
                <li><strong>Date Format:</strong> Important! Select the format (e.g., DD/MM/YYYY) that matches your Left CSV file <em>before</em> uploading to ensure dates and times appear correctly.</li>
                <li><strong>Method/Channel Filters:</strong> Use the scrollable checkboxes below the file inputs to filter specific payment methods or channels.</li>
            </ul>

            <h3 style="margin-top:15px; color:var(--primary);">2. Global Controls (Header)</h3>
            <ul style="padding-left: 20px; margin-bottom: 10px;">
                <li><strong>Theme Toggle (ðŸŒ™/â˜€):</strong> Switch between Dark and Light mode.</li>
                <li><strong>Date Filter:</strong> Show transactions for a specific date only. <em>Note: Changing this automatically Undoes all manual shifts/deletes.</em></li>
                <li><strong>Match IDs:</strong> Automatically inserts blank rows to align transactions that share the same Payment ID/Ref.</li>
                <li><strong>Sort Amount:</strong> Sorts both tables by monetary value (High to Low).</li>
                <li><strong>Red Only:</strong> Hides perfectly matched rows, showing only discrepancies (Red rows).</li>
                <li><strong>Reset:</strong> Wipes all data and files to start over.</li>
            </ul>

            <h3 style="margin-top:15px; color:var(--primary);">3. Manual Reconciliation (Toolbar)</h3>
            <p style="margin-bottom:5px; font-size:11px; color:var(--text-muted);">Select a row by clicking on it before using these buttons.</p>
            <ul style="padding-left: 20px; margin-bottom: 10px;">
                <li><strong>Shift Down (Spacebar):</strong> Inserts a blank row above the selected line to push data down and fix alignment issues.</li>
                <li><strong>Remove Row (Delete):</strong> Deletes the selected row entirely.</li>
                <li><strong>Undo (Ctrl+Z):</strong> Reverses the last Shift or Remove action.</li>
                <li><strong>Undo All:</strong> Reverts the table to its original uploaded state (removes all manual shifts and deletions).</li>
            </ul>

            <h3 style="margin-top:15px; color:var(--primary);">4. Visual Cues & Shortcuts</h3>
            <ul style="padding-left: 20px; margin-bottom: 0;">
                <li><strong>Red Text:</strong> Indicates the Amount, Tip, or Paid value differs between the two tables.</li>
                <li><strong>Red Background:</strong> Indicates the Payment IDs do not match on that row.</li>
                <li><strong>Alt + Click:</strong> Instantly selects the entire row on <strong>BOTH</strong> tables for easier comparison.</li>
                <li><strong>Floating Widget:</strong> Shows the total Sum and Count of currently selected cells.</li>
            </ul>
        </div>
    </div>
</div>

<script src="script.js"></script>
</body>
</html>
